<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Simulation Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-light-grey { background-color: #f8f9fa; }
        .bg-soft-amber { background-color: #fffbeb; }
        .text-dark-blue { color: #002e5d; }
        .bg-dark-blue { background-color: #002e5d; }
        .text-dark-grey { color: #4f4f4f; }
        .text-vivid-orange { color: #ff6700; }
        .bg-sharp-yellow { background-color: #ffd700; }
        .dsr-gauge-bg { background-color: #e9ecef; }
        .dsr-gauge-fill { transition: width 0.5s ease-in-out; }
        .refi-section {
            overflow: hidden;
            transition: max-height 0.7s ease-in-out, padding 0.7s ease-in-out, margin 0.7s ease-in-out;
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
        }
        .custom-dropdown-list {
            border: 1px solid #e2e8f0;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            background-color: white;
            width: 100%;
            z-index: 10;
        }
        .custom-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
        }
        .custom-dropdown-item:hover {
            background-color: #f1f5f9;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="bg-light-grey p-4 sm:p-8 rounded-2xl shadow-xl">
        <div class="max-w-7xl mx-auto">
            <header class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold font-serif text-dark-blue">Financial Simulation Calculator</h1>
                <p class="mt-2 text-lg text-dark-grey">Plan your journey to success. All figures in HKD.</p>
            </header>

            <div id="main-container" class="grid grid-cols-1 gap-8">
                <div id="input-column-container" class="lg:grid lg:grid-cols-2 lg:gap-8 bg-white p-6 rounded-lg shadow-md">
                    <div>
                        <h2 class="text-2xl font-bold font-serif text-dark-blue border-b pb-2 mb-4">1. Your Goals</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="studyDestination" class="block text-sm font-medium">Study Destination</label>
                                <select id="studyDestination" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm focus:ring-dark-blue focus:border-dark-blue"></select>
                            </div>
                            <div class="custom-dropdown relative">
                                <label for="university" class="block text-sm font-medium">University</label>
                                <input type="text" id="university" placeholder="Search for a university..." class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm focus:ring-dark-blue focus:border-dark-blue">
                                <div id="university-list" class="custom-dropdown-list hidden"></div>
                            </div>
                            <div>
                                <label for="tuition" class="block text-sm font-medium">Annual Tuition (HKD)</label>
                                <input type="number" id="tuition" value="350000" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="living" class="block text-sm font-medium">Monthly Living Expenses (HKD)</label>
                                <input type="number" id="living" value="12000" readonly style="border:none; background-color:transparent; box-shadow:none; outline:none; padding-left:0.5rem;" class="mt-1 block w-full p-2">
                            </div>
                            <div>
                                <label for="studyPeriod" class="block text-sm font-medium">Study Period or Years from Graduation (Years)</label>
                                <input type="range" id="studyPeriod" min="0.5" max="4" value="3" step="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                                <div class="text-center font-semibold text-dark-blue mt-1" id="studyPeriodValue">3 Years</div>
                            </div>
                            <div>
                                <label for="expectedSalary" class="block text-sm font-medium">Expected Monthly Salary After Graduation (HKD)</label>
                                <input type="range" id="expectedSalary" min="15000" max="80000" value="35000" step="1000" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                                <div class="text-center font-semibold text-dark-blue mt-1" id="expectedSalaryValue">HK$35,000</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold font-serif text-dark-blue border-b pb-2 mb-4">2. Your Resources</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="householdSavings" class="block text-sm font-medium">Household Savings Available for Education</label>
                                <input type="number" id="householdSavings" value="100000" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="householdSupport" class="block text-sm font-medium">Monthly Family Income Available to Pay for Education</label>
                                <input type="number" id="householdSupport" value="3000" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="dadSalary" class="block text-sm font-medium">Dad's Monthly Salary</label>
                                <input type="number" id="dadSalary" value="40000" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="mumSalary" class="block text-sm font-medium">Mum's Monthly Salary</label>
                                <input type="number" id="mumSalary" value="30000" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="partTimeHours" class="block text-sm font-medium">Part-time Hours per Week (max 20)</label>
                                <input type="range" id="partTimeHours" min="0" max="20" value="10" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                                <div class="text-center font-semibold text-dark-blue mt-1" id="partTimeHoursValue">10 Hours</div>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="calculateBtn" class="w-full bg-dark-blue text-white font-bold py-4 px-4 rounded-lg shadow-lg hover:bg-opacity-90 transition-transform transform hover:scale-105">Calculate My Financial Plan</button>
                
                <!-- *** NEW INELIGIBLE MESSAGE PANEL *** -->
                <div id="ineligibleMessagePanel" class="bg-orange-50 border-l-4 border-orange-400 p-6 rounded-lg shadow-md hidden">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-6 w-6 text-orange-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-xl font-bold text-orange-800">Let's Fine-Tune Your Plan!</h3>
                            <div class="mt-2 text-sm text-orange-700 space-y-3">
                                <p>Based on your inputs, the loan required appears to be higher than the total cost of your education. Our main goal is to help you succeed without taking on unnecessary debt, so we've paused here.</p>
                                <div>
                                    <p class="font-semibold">Quick things to check:</p>
                                    <ul class="mt-2 list-disc list-outside ml-5 space-y-2">
                                        <li><strong>Family Contribution:</strong> Have a chat with your parents! A small adjustment to the household income or savings figures might be all you need.</li>
                                        <li><strong>Part-Time Work:</strong> Could you add a few more part-time hours to your plan?</li>
                                        <li><strong>Borrowing Timing:</strong> You don't have to borrow from Day 1. Try setting the loan to start only in your final year or two. This drastically reduces the amount you need to borrow and might make your plan work!</li>
                                    </ul>
                                </div>
                                <p class="font-semibold">Keep exploring your options! We're here to help you find the best path forward.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- *** END OF NEW PANEL *** -->


                <div id="resultsPanel" class="bg-white p-6 rounded-lg shadow-md hidden">
                    <h2 class="text-2xl font-bold font-serif text-dark-blue border-b pb-2 mb-4">3. Your Loan Plan</h2>
                    
                    <div id="resultsContent">
                        <div class="text-center bg-light-grey p-4 rounded-lg">
                            <p class="text-sm text-dark-grey">Required Loan Amount</p>
                            <p id="loanAmount" class="text-4xl font-bold text-dark-blue">HK$0</p>
                        </div>
                        <div class="mt-6">
                            <p class="text-center font-semibold mb-2">Repayment Timeline</p>
                            <div class="h-64"><canvas id="repaymentChart"></canvas></div>
                        </div>
                        <div class="mt-6 grid grid-cols-2 gap-4 text-center">
                            <div class="bg-light-grey p-3 rounded">
                                <p class="text-sm">Payment (During Study)</p>
                                <p id="studyPayment" class="font-bold text-lg text-dark-blue">HK$0/mo</p>
                            </div>
                            <div class="bg-light-grey p-3 rounded">
                                <p class="text-sm">Payment (After Grad)</p>
                                <p id="gradPayment" class="font-bold text-lg text-dark-blue">HK$0/mo</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-center font-semibold mr-2 uppercase">Debt Servicing Ratio (Repayment Period)</span>
                                <button class="bg-dark-blue text-white rounded-full h-6 w-6 flex items-center justify-center text-sm font-bold popmake-1310" aria-label="Learn more about Debt Servicing Ratio (DSR)">?</button>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between text-sm mb-1"><span>Student</span><span id="studentDSRValue">0%</span></div>
                                    <div class="w-full dsr-gauge-bg rounded-full h-2.5"><div id="studentDSRFill" class="h-2.5 rounded-full dsr-gauge-fill"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1"><span>Household</span><span id="householdDSRValue">0%</span></div>
                                    <div class="w-full dsr-gauge-bg rounded-full h-2.5"><div id="householdDSRFill" class="h-2.5 rounded-full dsr-gauge-fill"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <div id="resultsError" class="hidden text-center text-red-500 py-8">
                        Could not calculate the loan plan due to an unexpected error. Please adjust your inputs and try again.
                    </div>
                </div>


                <button id="showRefiBtn" class="mt-8 w-full bg-sharp-yellow text-dark-blue font-bold py-3 px-4 rounded-lg shadow-lg hover:bg-opacity-90 transition-transform transform hover:scale-105 hidden">
                    Unlock >30% Interest Savings with Refinancing!
                </button>

                <div id="refi-section" class="bg-white rounded-lg shadow-md refi-section">
                    <div class="p-6">
                        <h2 class="text-2xl font-bold font-serif text-dark-blue border-b pb-2 mb-4">4. The Refinancing Advantage</h2>
                        <p id="refiDescription" class="text-sm text-dark-grey mb-4">After you graduate, you become a prime client for banks. By refinancing a portion of your SocioBridge loan, you can save significantly. Adjust the potential bank interest rate to see how.</p>
                        <div>
                            <label for="bankRate" class="block text-sm font-medium">Bank Interest Rate</label>
                            <input type="range" id="bankRate" min="1" max="9" value="4" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                            <div class="text-center font-semibold text-dark-blue mt-1" id="bankRateValue">6.0%</div>
                        </div>
                        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                            <div class="bg-light-grey p-4 rounded-lg">
                                <p class="font-bold">Your Two Futures</p>
                                <p class="text-xs mb-2">(Monthly Payment After Grad)</p>
                                <div class="h-40 relative"><canvas id="refiChart"></canvas></div>
                            </div>
                            <div class="bg-soft-amber p-4 rounded-lg flex flex-col items-center justify-center">
                                <p class="text-lg font-semibold text-dark-grey">Potential Interest Savings</p>
                                <p id="interestSaved" class="text-5xl font-bold text-dark-blue">0%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</body>
</html>